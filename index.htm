<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>공공데이터포탈</title>
</head>
<body>
	<select id="region">
		<option value="6480000" name="경상남도">경상남도</option>
		<option value="5360000" name="밀양시">밀양시</option>
		<option value="5670000" name="창원시">창원시</option>
		<option value="5410000" name="창녕군">창녕군</option>
		<option value="5370000" name="거제시">거제시</option>
		<option value="5330000" name="통영시">통영시</option>
		<option value="5350000" name="김해시">김해시</option>
		<option value="5380000" name="양산시">양산시</option>
		<option value="5400000" name="함안군">함안군</option>
		<option value="5460000" name="함양군">함양군</option>
		<option value="5440000" name="하동군">하동군</option>
		<option value="5310000" name="진주시">진주시</option>
		<option value="5340000" name="사천시">사천시</option>
		<option value="5430000" name="남해군">남해군</option>
		<option value="5470000" name="거창군">거창군</option>
		<option value="5480000" name="합천군">합천군</option>
		<option value="5390000" name="의령군">의령군</option>
		<option value="5420000" name="고성군">고성군</option>
		<option value="5450000" name="산청군">산청군</option>
	  </select>
	  ※경상남도를 선택했을때는 정확하지 않은건지 데이터를 넣질 않은건지 모르겠지만, 하위 지역들 보다 더 적게 나옵니다.
	  <br>
	<input type="text" id="dateFrom" placeholder="날짜(예:20230101)">00시01분01초<br>
	<input type="text" id="dateTo" placeholder="날짜(예:20231231)">23시59분59초<br>
	<button onclick="callApi()">API 호출</button>
	<p id="response"></p>

	
	<script src="app.js"></script>
	<script>
    function callApi() {
			alert("start")
			
			const regionvalue = document.getElementById('region').value;
			const dateFrom = document.getElementById('dateFrom').value + '000101';
			const dateTo = document.getElementById('dateTo').value + '235959';

			if(document.getElementById('dateFrom').value == '' || document.getElementById('dateFrom').value == undefined){
				alert("시작날짜를 입력해주세요.")
				return false;
			}
			if(document.getElementById('dateTo').value == '' || document.getElementById('dateTo').value == undefined){
				alert("끝날짜를 입력해주세요.")
				return false;
			}
			if((dateTo - dateFrom) < 0){
				alert("시작날짜가 끝날짜보다 클 수 없습니다.");
			}
			if(dateFrom.length != 14 || dateTo.length != 14){
				alert("시작날짜 또는 끝날짜는 8자리로 입력해야됩니다.");
			}

			

			alert("지역코드 :: " + regionvalue + ' / ' + "시작날짜 :: " +  dateFrom + ' / ' + "끝날짜 :: " + dateTo);
			// 공공데이터 api
			const url = 'https://apis.data.go.kr/1140100/minAnalsInfoView5/minStaticsInfo5?serviceKey=%2BFt24AieBZS226pLyjL27AFUlgQNvW5fiuAZAGXldP%2FsyRgKEe3ose2K%2FPbQ1kaOuxGg3HQkAHtCTeZjIA06UA%3D%3D&period=MONTHLY&sortBy=NAME&sortOrder=true&target=pttn%2Cdfpt%2Csaeol%2Cprpl%2Cqna%2Cqna_origin&dateFrom='+dateFrom+'&dateTo='+dateTo+'&mainSubvalue='+regionvalue;

			fetch(url)
				.then(res => res.json())
				.then(myJson => {
					alert("end")
					console.log(myJson);
					document.getElementById('response').innerHTML = JSON.stringify(myJson);
				})
		}
    
  </script>
</body>
</html>
